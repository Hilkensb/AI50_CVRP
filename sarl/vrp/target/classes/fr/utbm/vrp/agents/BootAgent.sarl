/** 
 * 
 */
package fr.utbm.vrp.agents


import io.sarl.core.Initialize
import io.sarl.core.Logging
import java.util.concurrent.atomic.AtomicInteger
import io.sarl.core.Lifecycle
import java.util.concurrent.ConcurrentLinkedQueue
import org.json.simple.parser.JSONParser
import java.io.StringReader
import org.json.simple.JSONObject
import org.json.simple.JSONArray
import java.util.Iterator

/** 
 * Boot agent
 * <br>His goal is just to launch the task agent and then die
 * 
 * <br>MAS Systems based on <a href=https://www.semanticscholar.org/paper/Agents-towards-vehicle-routing-problems-Vokr%C3%ADnek-Komenda/1d486f85f0810331c8feb203ac126a7c192d00e1#related-papers>Agents towards vehicle routing problems</a> article
 * <br>Strategy implemented: FIFO-ITER-CNP-RA
 * 
 */
agent BootAgent {
	uses Lifecycle, Logging

	on Initialize {
		// His logging name
		loggingName = "Boot agent"
		
		// Logging info
		info("The program has been launched.")

		// Get the json string
		var json_string = occurrence.parameters.get(0) as String
		json_string = json_string.replace("'", "\"");
		// var json_string: String = '{"topic":"aa", "depot": "1 0 0", "customers": ["2 31 3 75", "3 6 52 45", "4 7 8 9"], "vehicle_capacity":100}'

		var json_objc : Object = null;
		// Parse the json
		json_objc = new JSONParser().parse(new StringReader(json_string));

		// objc is convereted to JSON object
		var json_builded : JSONObject = json_objc as JSONObject;
		
		// Build the list of customers
		var customers_list : ConcurrentLinkedQueue<String> = new ConcurrentLinkedQueue<String>()
		var jsonArray : JSONArray = json_builded.get("customers") as JSONArray;
        // Iterating the contents of the array
		var iterator : Iterator<Object> = jsonArray.iterator();
		// Add all the customers in the list
		while (iterator.hasNext()) {
			customers_list.add(iterator.next() as String);
		}

		// Parse the depot
		var depot : String = json_builded.get("depot") as String;
		// Parse the vehicle cpacity
		var vehicle_capacity_raw : int = json_builded.get("vehicle_capacity") as String as int;
		var vehicle_capacity : AtomicInteger = new AtomicInteger(vehicle_capacity_raw);
		// Parse the topic
		var topic : String = json_builded.get("topic") as String;

		/* 
		 * // List of customers compose of
		// id, x, y, demand
		 * var customers_list : ConcurrentLinkedQueue<String> = new ConcurrentLinkedQueue<String>()
		// Create the customers
		customers_list.add("2 10 0 10")
		customers_list.add("3 10 25 95")
		customers_list.add("4 30 10 75")

		// id, x, y of the depot node
		var depot : String = "1 0 0"
		// Set the vehicle capacity
		var vehicle_capacity : AtomicInteger = new AtomicInteger(100)
		// Instance id to build the topic
		var topic: String = "aa"
		*/

		// Spawn the agent SearchManager and SearchAgent
		spawn(TaskAgent, depot, customers_list, vehicle_capacity, topic)

		// Kill it self
		killMe
	}
}
